"use strict";(self["webpackChunktrade_bots_dashboard"]=self["webpackChunktrade_bots_dashboard"]||[]).push([[64],{3260:(t,e,r)=>{r.d(e,{n:()=>i});class i{constructor({name:t,host:e,port:r,token:i}){this.name=t,this.host=e,this.port=r,this.token=i}get url(){return`http://${this.host}:${this.port}`}get authHeader(){return{Authorization:`Bearer ${this.token}`}}}},3043:(t,e,r)=>{r.d(e,{a:()=>d});var i=r(7363),o=r(7898),n=r(1623),s=r(1354),u=r(9981),c=r.n(u),a=function(t,e,r,i){function o(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,n){function s(t){try{c(i.next(t))}catch(e){n(e)}}function u(t){try{c(i["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):o(t.value).then(s,u)}c((i=i.apply(t,e||[])).next())}))};const d=(0,i.Q_)("portfolioActions",{state:()=>({}),getters:{},actions:{getPortfolio(t){return a(this,void 0,void 0,(function*(){const{data:e}=yield c().get(`${t.url}/api/state/portfolio`,{headers:t.authHeader});return e}))},updatePortfolio(t){return a(this,void 0,void 0,(function*(){const{data:e}=yield c().post(`${t.url}/api/state/portfolio`,{},{headers:t.authHeader});return e}))},getAverageBuyPrice(t,e){return a(this,void 0,void 0,(function*(){const{data:r}=yield c().get(`${t.url}/api/state/portfolio/${e}/average-buy-price`,{headers:t.authHeader});return r}))},getUnitedPortfolio(){return a(this,void 0,void 0,(function*(){(0,o.$)();const t=(0,n.V)(),e=((0,s.R)(),t.robots),r=e.map((t=>a(this,void 0,void 0,(function*(){return yield this.getPortfolio(t)})))),i=yield Promise.all(r),u=i.reduce(((t,e)=>(e.forEach((e=>{const r=t.find((t=>t.security_ticker==e.security_ticker));r?r.amount+=e.amount:t.push(e)})),t)),[]);return u}))}}})},1354:(t,e,r)=>{r.d(e,{R:()=>c});var i=r(7363),o=r(7898),n=r(9981),s=r.n(n),u=function(t,e,r,i){function o(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,n){function s(t){try{c(i.next(t))}catch(e){n(e)}}function u(t){try{c(i["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):o(t.value).then(s,u)}c((i=i.apply(t,e||[])).next())}))};const c=(0,i.Q_)("robotActions",{state:()=>({}),getters:{},actions:{getSecurities(t){return u(this,void 0,void 0,(function*(){const e=(0,o.$)(),{data:r}=yield s().get(`${t.url}/api/state/securities`,{headers:t.authHeader});return e.updateSecurities(r),r}))},updateSecurities(t){return u(this,void 0,void 0,(function*(){const e=(0,o.$)(),{data:r}=yield s().post(`${t.url}/api/state/securities`,{},{headers:t.authHeader});return e.updateSecurities(r),r}))},getCurrencies(t){return u(this,void 0,void 0,(function*(){const{data:e}=yield s().get(`${t.url}/api/state/currencies`,{headers:t.authHeader});return e}))},updateCurrencies(t){return u(this,void 0,void 0,(function*(){const{data:e}=yield s().post(`${t.url}/api/state/currencies`,{},{headers:t.authHeader});return e}))}}})},1623:(t,e,r)=>{r.d(e,{V:()=>d});var i=r(7363),o=r(3260),n=r(9981),s=r.n(n),u=r(1354),c=r(3043),a=function(t,e,r,i){function o(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,n){function s(t){try{c(i.next(t))}catch(e){n(e)}}function u(t){try{c(i["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):o(t.value).then(s,u)}c((i=i.apply(t,e||[])).next())}))};const d=(0,i.Q_)("robots",{state:()=>({robots:[]}),getters:{},actions:{checkRobotAuth(t){return a(this,void 0,void 0,(function*(){try{const e=new o.n(t),{data:r}=yield s().get(`${e.url}/api/auth/check`,{headers:e.authHeader});return r.auth}catch(e){return!1}}))},addRobot(t){return a(this,void 0,void 0,(function*(){const e=(0,u.R)(),r=(0,c.a)();if(!this.checkExistingRobot(t)){const i=new o.n(t);yield e.updateSecurities(i),yield r.updatePortfolio(i),this.robots.push(i)}}))},checkExistingRobot(t){const e=new o.n(t);return this.robots.some((t=>t.url===e.url))}}})},7898:(t,e,r)=>{r.d(e,{$:()=>o});var i=r(7363);const o=(0,i.Q_)("securities",{state:()=>({securities:[]}),getters:{},actions:{updateSecurities(t){t.forEach((t=>{const e=this.securities.find((e=>e.ticker===t.ticker));e?e.price=t.price:this.securities.push(t)}))},getSecurity(t){return this.securities.find((e=>e.ticker===t))}}})},4501:(t,e,r)=>{r.d(e,{Z:()=>Z});var i=r(9835);const o={class:"q-px-md q-my-lg q-mx-auto",style:{"max-width":"800px",background:"lightgray","border-radius":"5px"}},n={class:"q-pa-md"};function s(t,e,r,s,u,c){const a=(0,i.up)("PortfolioItem"),d=(0,i.up)("q-list");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",n,[(0,i.Wm)(d,{separator:"",style:{"max-height":"300px","overflow-y":"auto"},class:"bg-white"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.portfolio,((e,r)=>((0,i.wg)(),(0,i.j4)(a,{key:r,"portfolio-position":e,robot:t.robot},null,8,["portfolio-position","robot"])))),128))])),_:1})])])}var u=r(3043),c=r(7363),a=r(6970);function d(t,e,r,o,n,s){const u=(0,i.up)("q-item-label"),c=(0,i.up)("q-item-section"),d=(0,i.up)("Currency"),l=(0,i.up)("q-item");return(0,i.wg)(),(0,i.j4)(l,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{style:{"font-size":"18px","font-weight":"bold"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.portfolioPosition.security_ticker),1)])),_:1}),(0,i.Wm)(u,{caption:"",style:{"font-size":"14px"}},{default:(0,i.w5)((()=>[(0,i.Uk)("x"+(0,a.zw)(t.portfolioPosition.amount),1)])),_:1})])),_:1}),(0,i.Wm)(c,{side:"",top:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{caption:"",style:{"font-size":"16px","font-weight":"bold"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.security.price)+" ",1),(0,i.Wm)(d,{ticker:t.security.currency_ticker},null,8,["ticker"])])),_:1}),t.robot?((0,i.wg)(),(0,i.j4)(u,{key:0,caption:"",class:(0,a.C_)("text-"+(t.growth?"green":"red")),style:{"font-size":"14px"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.growth?"↑":"↓")+(0,a.zw)(t.diffAbsolute)+" ",1),(0,i.Wm)(d,{ticker:t.security.currency_ticker},null,8,["ticker"]),(0,i.Uk)(" ("+(0,a.zw)(t.diffRelative)+" %) ",1)])),_:1},8,["class"])):(0,i.kq)("",!0)])),_:1})])),_:1})}var l=r(3260),h=r(7898);function f(t,e,r,i,o,n){return(0,a.zw)(t.sign)}const p=(0,i.aZ)({name:"Currency",props:{ticker:{type:String,required:!0}},computed:{sign(){switch(this.ticker){case"USD":return"$";case"RUB":return"₽";case"EUR":return"€";default:return"M"}}}});var y=r(1639);const v=(0,y.Z)(p,[["render",f]]),g=v;var b=function(t,e,r,i){function o(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,n){function s(t){try{c(i.next(t))}catch(e){n(e)}}function u(t){try{c(i["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):o(t.value).then(s,u)}c((i=i.apply(t,e||[])).next())}))};const m=(0,i.aZ)({name:"PortfolioItem",components:{Currency:g},props:{portfolioPosition:{type:Object,required:!0},robot:{type:l.n,required:!1}},data(){return{buyPrice:{ticker:"",price:0},loading:!0}},methods:Object.assign({},(0,c.nv)(u.a,["getAverageBuyPrice"])),computed:Object.assign(Object.assign({},(0,c.rn)(h.$,["securities"])),{security(){return this.securities.find((t=>t.ticker===this.portfolioPosition.security_ticker))},growth(){var t;return((null===(t=this.security)||void 0===t?void 0:t.price)||0)>this.buyPrice.price},diffAbsolute(){var t;let e=Math.abs(((null===(t=this.security)||void 0===t?void 0:t.price)||0)-this.buyPrice.price);return Math.round(100*e)/100},diffRelative(){let t=this.diffAbsolute/this.buyPrice.price;return Math.round(100*t)/100}}),created(){return b(this,void 0,void 0,(function*(){this.loading=!0,this.robot&&(this.buyPrice=yield this.getAverageBuyPrice(this.robot,this.portfolioPosition.security_ticker)),this.loading=!1}))}});var w=r(490),k=r(1233),P=r(3115),_=r(9984),x=r.n(_);const $=(0,y.Z)(m,[["render",d]]),q=$;x()(m,"components",{QItem:w.Z,QItemSection:k.Z,QItemLabel:P.Z});const z=(0,i.aZ)({name:"PortfolioView",components:{PortfolioItem:q},props:{portfolio:{type:Array,required:!0},robot:{type:Object,required:!1}},computed:{},methods:Object.assign({},(0,c.nv)(u.a,["getAverageBuyPrice"]))});var A=r(3246);const R=(0,y.Z)(z,[["render",s]]),Z=R;x()(z,"components",{QList:A.Z})}}]);