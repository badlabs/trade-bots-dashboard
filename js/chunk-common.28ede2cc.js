"use strict";(self["webpackChunktrade_bots_dashboard"]=self["webpackChunktrade_bots_dashboard"]||[]).push([[64],{3260:(t,e,r)=>{r.d(e,{n:()=>n});class n{constructor({name:t,host:e,port:r,token:n}){this.name=t,this.host=e,this.port=r,this.token=n}get url(){return`http://${this.host}:${this.port}`}get authHeader(){return{Authorization:`Bearer ${this.token}`}}}},3043:(t,e,r)=>{r.d(e,{a:()=>a});var n=r(7363),i=r(1623),o=r(9981),s=r.n(o),c=function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function c(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):i(t.value).then(s,c)}a((n=n.apply(t,e||[])).next())}))};const a=(0,n.Q_)("portfolioActions",{state:()=>({}),getters:{},actions:{getPortfolio(t){return c(this,void 0,void 0,(function*(){const{data:e}=yield s().get(`${t.url}/api/state/portfolio`,{headers:t.authHeader});return e}))},getCurrenciesBalance(t){return c(this,void 0,void 0,(function*(){const{data:e}=yield s().get(`${t.url}/api/state/currencies/balance`,{headers:t.authHeader});return e}))},updatePortfolio(t){return c(this,void 0,void 0,(function*(){const{data:e}=yield s().post(`${t.url}/api/state/portfolio`,{},{headers:t.authHeader});return e}))},getAverageBuyPrice(t,e){return c(this,void 0,void 0,(function*(){const{data:r}=yield s().get(`${t.url}/api/state/portfolio/${e}/average-buy-price`,{headers:t.authHeader});return r}))},getUnitedPortfolio(){return c(this,void 0,void 0,(function*(){const t=(0,i.V)(),e=t.robots,r=e.map((t=>c(this,void 0,void 0,(function*(){return yield this.getPortfolio(t)})))),n=yield Promise.all(r),o=n.reduce(((t,e)=>(e.forEach((e=>{const r=t.find((t=>t.security_ticker==e.security_ticker));r?r.amount+=e.amount:t.push(e)})),t)),[]);return o}))},getUnitedBalance(){return c(this,void 0,void 0,(function*(){const t=(0,i.V)(),e=t.robots,r=e.map((t=>c(this,void 0,void 0,(function*(){return yield this.getCurrenciesBalance(t)})))),n=yield Promise.all(r),o=n.reduce(((t,e)=>(e.forEach((e=>{const r=t.find((t=>t.currency_ticker==e.currency_ticker));r?r.balance+=e.balance:t.push(e)})),t)),[]);return o}))}}})},1354:(t,e,r)=>{r.d(e,{R:()=>a});var n=r(7363),i=r(7898),o=r(9981),s=r.n(o),c=function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function c(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):i(t.value).then(s,c)}a((n=n.apply(t,e||[])).next())}))};const a=(0,n.Q_)("robotActions",{state:()=>({}),getters:{},actions:{getSecurities(t){return c(this,void 0,void 0,(function*(){const e=(0,i.$)(),{data:r}=yield s().get(`${t.url}/api/state/securities`,{headers:t.authHeader});return e.updateSecurities(r),r}))},updateSecurities(t){return c(this,void 0,void 0,(function*(){const e=(0,i.$)(),{data:r}=yield s().post(`${t.url}/api/state/securities`,{},{headers:t.authHeader});return e.updateSecurities(r),r}))},getCurrencies(t){return c(this,void 0,void 0,(function*(){const{data:e}=yield s().get(`${t.url}/api/state/currencies`,{headers:t.authHeader});return e}))},updateCurrencies(t){return c(this,void 0,void 0,(function*(){const{data:e}=yield s().post(`${t.url}/api/state/currencies`,{},{headers:t.authHeader});return e}))}}})},1623:(t,e,r)=>{r.d(e,{V:()=>l});var n=r(7363),i=r(3260),o=r(9981),s=r.n(o),c=r(1354),a=r(3043),u=function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function c(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):i(t.value).then(s,c)}a((n=n.apply(t,e||[])).next())}))};const l=(0,n.Q_)("robots",{state:()=>({robots:[]}),getters:{},actions:{checkRobotAuth(t){return u(this,void 0,void 0,(function*(){try{const e=new i.n(t),{data:r}=yield s().get(`${e.url}/api/auth/check`,{headers:e.authHeader});return r.auth}catch(e){return!1}}))},addRobot(t){return u(this,void 0,void 0,(function*(){const e=(0,c.R)(),r=(0,a.a)();if(!this.checkExistingRobot(t)){const n=new i.n(t);yield e.updateSecurities(n),yield r.updatePortfolio(n),this.robots.push(n)}}))},checkExistingRobot(t){const e=new i.n(t);return this.robots.some((t=>t.url===e.url))}}})},7898:(t,e,r)=>{r.d(e,{$:()=>i});var n=r(7363);const i=(0,n.Q_)("securities",{state:()=>({securities:[]}),getters:{},actions:{updateSecurities(t){t.forEach((t=>{const e=this.securities.find((e=>e.ticker===t.ticker));e?e.price=t.price:this.securities.push(t)}))},getSecurity(t){return this.securities.find((e=>e.ticker===t))}}})},576:(t,e,r)=>{r.d(e,{Z:()=>p});var n=r(9835),i=r(6970);function o(t,e,r,o,s,c){const a=(0,n.up)("q-avatar");return(0,n.wg)(),(0,n.j4)(a,{size:"30px",color:t.color,class:"text-white"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.firstLetter),1)])),_:1},8,["color"])}const s=r(5168),c=(0,n.aZ)({name:"RobotAvatar",props:{name:{type:String,required:!0}},data(){return{colors:["red","blue","orange","green","teal","purple","deep-purple","indigo","brown"],rand:s(this.name)}},computed:{color(){return this.colors[this.rand(this.colors.length)]},firstLetter(){return this.name.substring(0,1)}}});var a=r(1639),u=r(1357),l=r(9984),d=r.n(l);const h=(0,a.Z)(c,[["render",o]]),p=h;d()(c,"components",{QAvatar:u.Z})},8693:(t,e,r)=>{r.d(e,{Z:()=>h});var n=r(9835),i=r(6970);const o={style:{"overflow-y":"auto"}};function s(t,e,r,s,c,a){return(0,n.wg)(),(0,n.iD)("code",o,[(0,n._)("pre",{class:"bg-black text-white q-pa-md",style:(0,i.j5)([{overflow:"auto"},{whiteSpace:t.singleLine?"pre-wrap":void 0}])},(0,i.zw)(t.singleLine?t.lastLine:t.logs),5)])}var c=r(3819),a=r(3260);const u=(0,n.aZ)({name:"RobotLogs",props:{robot:{type:a.n,required:!0},singleLine:{type:Boolean,required:!1}},data(){return{connection:null,logs:""}},computed:{lastLine(){return this.logs.split("\n").slice(-2)[0]}},mounted(){const t=`${this.robot.url}`;this.connection=(0,c.io)(t),this.connection.on("log",(t=>{console.log(t),this.logs+=t+"\n"}))},beforeUnmount(){var t;null===(t=this.connection)||void 0===t||t.close()}});var l=r(1639);const d=(0,l.Z)(u,[["render",s]]),h=d},1925:(t,e,r)=>{r.d(e,{Z:()=>j});var n=r(9835),i=r(6970);const o={class:"q-px-md q-my-lg q-mx-auto",style:{"max-width":"800px",background:"lightgray","border-radius":"5px"}},s=(0,n.Uk)("Portfolio");function c(t,e,r,c,a,u){const l=(0,n.up)("q-card-section"),d=(0,n.up)("CurrencySign"),h=(0,n.up)("PortfolioItem"),p=(0,n.up)("q-list"),f=(0,n.up)("q-spinner-ball"),g=(0,n.up)("q-inner-loading");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(l,{class:"text-h4"},{default:(0,n.w5)((()=>[(0,n.WI)(t.$slots,"default",{},(()=>[s]))])),_:3}),t.balance?((0,n.wg)(),(0,n.j4)(l,{key:0,class:"bg-white q-mx-md rounded-borders"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.balance,(t=>((0,n.wg)(),(0,n.iD)("span",{key:t.currency_ticker,class:"q-mr-md"},[(0,n.Uk)((0,i.zw)(t.balance.toLocaleString("de-DE")),1),(0,n.Wm)(d,{ticker:t.currency_ticker,class:"text-bold"},null,8,["ticker"])])))),128))])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(l,{class:"q-pa-md"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{separator:"",style:{"max-height":"300px","overflow-y":"auto"},class:"bg-white rounded-borders"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.portfolio,((e,r)=>((0,n.wg)(),(0,n.j4)(h,{key:r,"portfolio-position":e,robot:t.robot},null,8,["portfolio-position","robot"])))),128))])),_:1})])),_:1}),(0,n.Wm)(g,{showing:t.loading},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{size:"50px",color:"primary"})])),_:1},8,["showing"])])}var a=r(3043),u=r(7363);function l(t,e,r,o,s,c){const a=(0,n.up)("q-item-label"),u=(0,n.up)("q-item-section"),l=(0,n.up)("CurrencySign"),d=(0,n.up)("q-spinner-facebook"),h=(0,n.up)("q-inner-loading"),p=(0,n.up)("q-item");return(0,n.wg)(),(0,n.j4)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(a,{style:{"font-size":"18px","font-weight":"bold"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.security.name),1)])),_:1}),(0,n.Wm)(a,{caption:"",style:{"font-size":"14px"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.portfolioPosition.security_ticker)+" x"+(0,i.zw)(t.portfolioPosition.amount),1)])),_:1})])),_:1}),(0,n.Wm)(u,{side:"",top:""},{default:(0,n.w5)((()=>[(0,n.Wm)(a,{caption:"",style:{"font-size":"16px","font-weight":"bold"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.security.price)+" ",1),(0,n.Wm)(l,{ticker:t.security.currency_ticker},null,8,["ticker"])])),_:1}),t.robot?((0,n.wg)(),(0,n.j4)(a,{key:0,caption:"",class:(0,i.C_)("text-"+(t.growth?"green":"red")),style:{"font-size":"14px"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.growth?"↑":"↓")+(0,i.zw)(t.buyPrice.price)+" ",1),(0,n.Wm)(l,{ticker:t.security.currency_ticker},null,8,["ticker"]),(0,n.Uk)(" ("+(0,i.zw)(t.diffRelative)+" %) ",1)])),_:1},8,["class"])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(h,{showing:t.loading},{default:(0,n.w5)((()=>[(0,n.Wm)(d)])),_:1},8,["showing"])])),_:1})}var d=r(3260),h=r(7898);function p(t,e,r,o,s,c){return(0,n.wg)(),(0,n.iD)("span",null,(0,i.zw)(t.sign),1)}const f=(0,n.aZ)({name:"CurrencySign",props:{ticker:{type:String,required:!0}},computed:{sign(){switch(this.ticker){case"USD":return"$";case"RUB":return"₽";case"EUR":return"€";default:return"M"}}}});var g=r(1639);const y=(0,g.Z)(f,[["render",p]]),v=y;var b=function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function c(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):i(t.value).then(s,c)}a((n=n.apply(t,e||[])).next())}))};const w=(0,n.aZ)({name:"PortfolioItem",components:{CurrencySign:v},props:{portfolioPosition:{type:Object,required:!0},robot:{type:d.n,required:!1}},data(){return{buyPrice:{ticker:"",price:0},loading:!0}},methods:Object.assign(Object.assign({},(0,u.nv)(a.a,["getAverageBuyPrice"])),(0,u.nv)(h.$,["getSecurity"])),computed:Object.assign(Object.assign({},(0,u.rn)(h.$,["securities"])),{security(){return this.getSecurity(this.portfolioPosition.security_ticker)},growth(){var t;return((null===(t=this.security)||void 0===t?void 0:t.price)||0)>this.buyPrice.price},diffAbsolute(){var t;let e=Math.abs(((null===(t=this.security)||void 0===t?void 0:t.price)||0)-this.buyPrice.price);return Math.round(100*e)/100},diffRelative(){let t=this.diffAbsolute/this.buyPrice.price*100;return Math.round(100*t)/100}}),created(){return b(this,void 0,void 0,(function*(){this.loading=!0,this.robot&&(this.buyPrice=yield this.getAverageBuyPrice(this.robot,this.portfolioPosition.security_ticker)),this.loading=!1}))}});var m=r(490),k=r(1233),P=r(3115),_=r(854),x=r(7234),q=r(9984),S=r.n(q);const Z=(0,g.Z)(w,[["render",l]]),$=Z;S()(w,"components",{QItem:m.Z,QItemSection:k.Z,QItemLabel:P.Z,QInnerLoading:_.Z,QSpinnerFacebook:x.Z});var z=function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function c(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):i(t.value).then(s,c)}a((n=n.apply(t,e||[])).next())}))};const U=(0,n.aZ)({name:"PortfolioView",components:{CurrencySign:v,PortfolioItem:$},props:{robot:{type:Object,required:!1}},data(){return{portfolio:[],balance:[],loading:!1}},methods:Object.assign({},(0,u.nv)(a.a,["getAverageBuyPrice","getUnitedPortfolio","getUnitedBalance","getPortfolio","getCurrenciesBalance"])),mounted(){return z(this,void 0,void 0,(function*(){this.loading=!0,this.robot?(this.portfolio=yield this.getPortfolio(this.robot),this.balance=yield this.getCurrenciesBalance(this.robot)):(this.portfolio=yield this.getUnitedPortfolio(),this.balance=yield this.getUnitedBalance()),this.loading=!1}))}});var W=r(3190),B=r(3246),C=r(5304);const Q=(0,g.Z)(U,[["render",c]]),j=Q;S()(U,"components",{QCardSection:W.Z,QList:B.Z,QInnerLoading:_.Z,QSpinnerBall:C.Z})}}]);